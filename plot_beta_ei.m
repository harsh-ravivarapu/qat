% This function is used to run tests regarding the reset and step function
% it can be used to find average performance of reward functions, test
% normal stimulation, graph beta and EI after stimulation is applied

%% Doing some runs (With Reward Function 6)
tic;
freq = 50;
l = 400;
steps = 2;
episodes = 1;
stride = 2; 
window_size = 200;
dt = 0.01;
b = (freq*l)/1000;

reward = [];

for i = 1:episodes
    [InitialObservation, IT] = reset_function_SMC_step(freq,l,dt,stride,window_size);
    this_reward = 0;
    for j = 1:steps
        Action = create_stim(l,b,freq);
        [Observation,Reward,isdone,IT] = step_function_SMC_step(Action,IT,freq,l,b,dt,stride,window_size);%[Observation,Reward,isdone,kk,IT] = step_function_SMC_step(Action,kk,IT,freq,l,b,step_size,window);
        this_reward = this_reward + Reward;
    end
    reward = [reward this_reward];
end
toc
%% loading last one
window = 1;

beta = [];
ei = [];

for i=1:steps
    load(append(int2str(i),"pd50rs.mat"))
    beta = [beta beta_vec];
    ei = [ei EI];
end

%%
figure;
plot(linspace(window_size,steps*l,length(beta))*0.001,beta)
title(strcat('Power in Beta Frequency Band, GPi, Length ',int2str(l),'ms, ',int2str(freq),'Hz, Stride ',int2str(stride),'ms, Window Size ',int2str(window_size),'ms'))
xlabel('Time (sec)')
ylabel('PSD')
ylim([0 650])
savefig(strcat('Half Beta Length ',int2str(l),'ms ',int2str(freq),'Hz Stride ',int2str(stride),'ms Window Size ',int2str(window_size),'ms.fig'))
saveas(gcf,strcat('Half Beta Length ',int2str(l),'ms ',int2str(freq),'Hz Stride ',int2str(stride),'ms Window Size ',int2str(window_size),'ms.png'))

% figure;
% plot(linspace(1,l,length(ei))*0.001,ei)
% title('Error Index, Length 100ms, 130Hz')
% xlabel('Time (sec)')
% ylabel('Error Index (EI)')
% ylim([0 1])


load("0pd0rs.mat")
obs_beta = [beta_vec,beta];
obs_ei = [EI ei];
time = linspace(window_size,(steps+1)*l,length(obs_beta))*0.001;
len = l;


figure;
plot(time,obs_beta)
hold on
plot([len/1000,len/1000],[0,1000])
title(strcat('Power in Beta Frequency Band, GPi, Length ',int2str(l),'ms, ',int2str(freq),'Hz, Stride ',int2str(stride),'ms, Window Size ',int2str(window_size),'ms'))
xlabel('Time (sec)')
ylabel('PSD')
ylim([0 650])
savefig(strcat('All Beta Length ',int2str(l),'ms ',int2str(freq),'Hz Stride ',int2str(stride),'ms Window Size ',int2str(window_size),'ms.fig'))
saveas(gcf,strcat('All Beta Length ',int2str(l),'ms ',int2str(freq),'Hz Stride ',int2str(stride),'ms Window Size ',int2str(window_size),'ms.png'))

% figure;
% plot(time,obs_ei)
% hold on
% plot([len/1000,len/1000],[0,1000])
% title('Error Index, Length 100ms, 130Hz')
% xlabel('Time (sec)')
% ylabel('PSD')
% ylim([0 1])
%% 

% %% Reward
% avg = [11.432727446424094 ,10.908771603693257 ,11.659405672965653 ,12.36999857121778 ,12.689585970844462 ,11.911010175421241 ,12.725074154486407 ,11.459873129993206 ,12.963990853735224 ,11.77112579673258 ,11.669857653128545 ,11.55601464784435 ,11.929278128609717 ,10.36756197863998 ,11.09907826525908 ,12.374645788685605 ,10.974562082001947 ,10.907020831901809 ,11.997621985767827 ,10.588861960632538 ,11.379603310788138 ,11.72824093221398 ,11.386607243055535 ,11.309933801601954 ,10.989432012716996 ,12.319241967646212 ,11.54826188258391 ,12.244306724497346 ,11.86431738971334 ,12.10591893640696 ,12.603927081467969 ,11.850765890808907 ,11.759805780716203 ,11.831448909175844 ,10.542899482561324 ,12.70727023959308 ,12.423577715465536 ,11.061080509066068 ,11.229676253828424 ,11.328084231769985 ,11.796624078655725 ,12.23000179320043 ,12.283545653573674 ,12.020293974216559 ,10.884978635494868 ,10.211741865828404 ,11.09748863729406 ,9.968256293763405 ,10.3081152091987 ,9.76161364544498 ,10.438268025027 ,10.608778221456237 ,10.311353848719556 ,10.479869866027265 ,10.630456338184251 ,9.812021038228785 ,10.547593435589418 ,10.905902417742448 ,9.6383259403042 ,10.840174111281568 ,10.996585614175507 ,8.952185120935708 ,10.006793800913321 ,9.710022924484694 ,10.718531807695861 ,10.82826954987772 ,10.768814818155045 ,13.114383152246488 ,13.280660923135905 ,13.712513121712608 ,14.698511334747858 ,13.904648256155019 ,13.381111580154199 ,12.675385191904912 ,14.646466571405053 ,13.872448484174974 ,13.24945860551523 ,13.20038310239376 ,12.749696788171653 ,12.333730790256066 ,12.880724875236314 ,12.168528502029952 ,14.106039375867738 ,12.916805649399581 ,12.443309463663883 ,12.690418988667359 ,13.096369630253553 ,13.601317257502458 ,13.076513606353679 ,12.651697411598333 ,12.709765083402655 ,12.237470692696704 ,14.11492121889509 ,12.334565347333855 ,13.220036424084997 ,12.635419720484116 ,13.464314569458352 ,13.932612788380574 ,11.786806233928642 ,13.196913356219406 ,13.01401298927634 ,13.494420086544013 ,13.78733734516618 ,12.925318725725468 ,13.576548366164094 ,13.162788138366377 ,13.716755503447734 ,12.775168408662527 ,12.845025318392992 ,12.547055550541094 ,13.043211990611043 ,13.59411735915536 ,13.72515367921791 ,13.563184417205319 ,12.98566117307669 ,13.509756898338704 ,12.927339066994879 ,12.454396638754826 ,13.663209608819084 ,13.142277200408786 ,13.053788125677405 ,12.838015991062118 ,13.500119399292073 ,13.332828537979456 ,14.19271366036435 ,13.547385546220177 ,12.99573670884718 ,13.688640227025283 ,13.29913749672739 ,13.577269664388231 ,12.605172150210468 ,13.246936271531057 ,14.764203544971227 ,13.4657215555445 ,13.051504297907336 ,12.443923609725365 ,12.22001996256253 ,13.331004445790407 ,13.330303777328146 ,13.862317246846342 ,12.826681128055997 ,13.098643501990097 ,13.662379475280435 ,14.142580818896514 ,13.38158909636769 ,12.376754658939088 ,12.567873276810863 ,14.129915895111274 ,12.803035304381421 ,12.969342063567558 ,12.638596299552667 ,12.955111237980468 ,12.891313777968417 ,13.555583994630442 ,13.775341595843704 ,13.288812186148645 ,13.04782752422418 ,14.343956111033432 ,13.82595049029308 ,12.98763231988426 ,12.556794333742157 ,13.406819132898262 ,12.42703911783948 ,13.211208534611325 ,13.043673317728954 ,14.182827347886143 ,12.98577793587152 ,13.35357890195541 ,13.83543251099856 ,13.234882822909933 ,12.791906827379004 ,12.220558742783911 ,12.810297697515079 ,12.939872678392822 ,13.3322654083534 ,13.39141179041117 ,13.235720357652353 ,13.802639296088302 ,13.55318340060158 ,12.828426904351154 ,13.07850911962988 ,12.51149725441364 ,12.653166700557172 ,13.479768580986116 ,13.130452915271839 ,12.964664052778868 ,12.80903978074904 ,12.434171819400024 ,13.325223082703813 ,14.278596979701149 ,13.18509160217947 ,13.690067412616473 ,14.273908635711615 ,14.803463894424173 ,13.457065227770796 ,13.012451816347475 ,12.461679854152273 ,13.11196576060298 ,13.799639327337447 ,13.74769178412107 ,13.55677023443087 ,12.72576394211251 ,13.788457128647792 ,13.16025955241164 ,12.769997819151596 ,13.57392848359441 ,13.329536348967373 ,13.132170455142083 ,12.974977892002919 ,12.684418896925981 ,13.523518180520025 ,14.782182371717692 ,13.206292600417543 ,13.873185236118804 ,13.970138294099339 ,13.640329689719943 ,13.24071611283968 ,12.88324537225445 ,12.719864037252208 ,14.13195954912384 ,14.427219148862273 ,13.77433302911451 ,13.233112882040281 ,12.558974148366762 ,12.854741734670295 ,12.579869395606824 ,14.548460532285723 ,12.922191673447008 ,13.12987180058379 ,13.676248757532111 ,13.073922592389396 ,12.674178742839082 ,12.780254103464518 ,13.96304919675562 ,13.23819440128798 ,13.470215941585904 ,14.877250775229653 ,12.52402152880432 ,13.371943639889684 ,13.028564353249827 ,12.21671610913302 ,12.593834421311795 ,14.254362649296462 ,13.409044935146525 ,12.58538986709903 ,12.932242858624056 ,13.640751715243237 ,13.865256834869594 ,13.94210351402101 ,14.251770321458153 ,12.416598563475533 ,12.558428418343919 ,12.843567077700957 ,14.94673512933372 ,13.821618237808725 ,13.6277153588181 ,12.797865438170744 ,13.159167752240657 ,12.51643794515246 ,13.411094551676285 ,12.625784616409367 ,13.176166616014271 ,12.392121201788903 ,13.447522272568232 ,12.841516836413595 ,12.84637388118821 ,13.444255068230007 ,12.948683203302181 ,12.62889131228713 ,12.9152313354128 ,13.783438615367043 ,14.266116879589484 ,12.255222063709168 ,13.337742858844258 ,12.514073738456249 ,13.394646043359227 ,13.909600654407386 ,13.59511756644217 ,12.69149354135374 ,13.532959170684117 ,12.581098105671932 ,12.618972988931285 ,13.077397629590186 ,14.120567044585652 ,12.977771320745587 ,12.669493834026191 ,13.59058632259733 ,13.124059905106506 ,12.37590970577327 ,13.022417040737478 ,13.99156855407157 ,12.680591588836547 ,13.590816778587852 ,13.396845653767528 ,13.444181834843315 ,12.337598928059807 ,12.952111108179034 ,12.35513974092262 ,12.266727518449217 ,13.668274048965637 ,12.882673279510295 ,13.96046483071149,12.493050297681876 ,14.438922217645116 ,13.118945100744233 ,13.485659215823496 ,12.879345869576914 ,13.107401571218528 ,12.13900859317378 ,12.19459151645842 ,12.786941659687683 ,13.318024406949728 ,13.425432120375913 ,12.591824120425489 ,13.166814811967045 ,13.729751258627354 ,13.111514345010972 ,12.465347402319878 ,12.787387101845855 ,13.416340117376329 ,13.521328736046117 ,12.25226281469047 ,13.5540566048603 ,13.591086733084348 ,13.20138091455118 ,13.514376802135649 ,12.501290197060195 ,13.806594280774483 ,13.137367123305308 ,12.850164306165569 ,12.710623131930658 ,13.567946704333107 ,13.959104316576276 ,13.271726226481906 ,13.240103215019667 ,13.817204909273157 ,12.875230758350725 ,13.502196797247692 ,13.80227165919739 ,12.196976122872053 ,13.015706858045146 ,13.085702664588858 ,13.248050132799191 ,13.375023449627047 ,12.919181476901612 ,12.838314610979136 ,13.570923931158717 ,12.356768563661111 ,13.502637031471238 ,13.248855757082115 ,13.589194401212598 ,13.024085924877095 ,12.915447595590814 ,12.159110777362585 ,13.548707942834367 ,13.524080997004821 ,12.665756218837311 ,13.946255329187487 ,13.500031244367962 ,13.183789150993988 ,13.335871993471716 ,13.112353530168908 ,13.314267825006484 ,13.750863195540346 ,13.646865186166899 ,12.778753307049376 ,12.784013695320082 ,13.87045338624856 ,13.156190657449633 ,12.439095423745897 ,13.578544201565073 ,12.754984946602406 ,12.963632628924156 ,13.35395328756615 ,14.043265244585097 ,14.001847301135992 ,13.239126803505691 ,13.779355322802456 ,14.117004618962346 ,13.118148980714285 ,13.73116216803324 ,12.462627281938529 ,13.668877213553214 ,13.568629923639596 ,13.090364125916388 ,13.175687664009093 ,12.676333189873509 ,14.348870269414217 ,12.568550850673699 ,11.902416357099819 ,12.698663354532151 ,12.218121032565186 ,13.49471828786777 ,13.52290633129051 ,14.19564763947943 ,12.589858582861044 ,11.958244458925165 ,13.646221362786562 ,12.95736280009917 ,12.54902646729526 ,12.085556940632461 ,12.780647841971401 ,13.281588249131456 ,13.849607408124415 ,13.068339777857558 ,12.465111251699522 ,13.434437958392165 ,13.888294665732275 ,13.125831531744307 ,13.25230259129304 ,13.59831210937711 ,13.714821972604096 ,13.030327742307756 ,13.620073799636536 ,12.858683180377316 ,13.710674388829828 ,13.400216126155792 ,13.846563349521086 ,12.456706050892096 ,13.205097576331042 ,12.659101177372097 ,13.165277717982617 ,13.01673575140259 ,12.656970586358439 ,13.31514767713648 ,13.08186576377362 ,13.575137548176366 ,13.473776439338113 ,13.093127331630074 ,14.23806691060068 ,14.715014444658243 ,13.482627089193858 ,13.136087790938678 ,12.529501587723306 ,13.072978735290754 ,13.724495775351565 ,13.130339540130747 ,12.906398816995058 ,13.530313919804541 ,12.231532592371163 ,13.791578444069959 ,14.334669252177314 ,13.358146505581374 ,13.523847753547276 ,13.048603172442455 ,13.17340414817291 ,12.878735883690657 ,13.010995844782958 ,13.735333772512407 ,13.175697203097995 ,13.72978729160645 ,12.07213734222023 ,13.46415219298266 ,15.48815404468309 ,13.373531073691295 ,13.540324983212225 ,12.619383954577506 ,13.80362031678963 ,13.389342793444824 ,13.910104779498608 ,12.792668807302432 ,13.450438889858624 ,14.423020374703837 ,13.279164926545622 ,13.536346909801757 ,13.115072186262761 ,13.361819548458847 ,12.499960302865711 ,12.805578635954035 ,13.990097517392988 ,12.706845416430278 ,13.122191490890108 ,12.560622012518326 ,12.915587201875942 ,12.508839330491401 ,12.78665386304474 ,14.3268707703457 ,12.524348977515789 ,12.550245481501586 ,12.771367910473044 ,12.675544169230198 ,12.437289521088934 ,12.71981078702482 ,13.888725250285141 ,12.222803406197508 ,13.616645381194864 ,13.38314879980717 ,12.224721807163181 ,12.766692706913275 ,12.69876241115564 ,13.11475103800933 ,14.27453233732098 ,12.990529800376013 ,12.862982328290428 ,13.53468046126105 ,14.247339713047827 ,13.522336061776745 ,12.691635059346712 ,13.841191743392473 ,13.33834325817886 ,12.794550819765515 ,13.749639896385547 ,13.662111430084847]; 
% 
% 
% figure;
% plot(avg)
% title('Average Reward, Python, Altered Reward, Laptop')
% xlabel('Episode')
% ylabel('Reward')
% ylim([-25 25])